<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¸å¼¹ç¿»ç‰Œæ¸¸æˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(0, 0, 30, 0.85);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        .page {
            padding: 30px;
            display: none;
        }
        
        .active {
            display: block;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
            font-size: 2.5rem;
        }
        
        /* ç™»å½•é¡µé¢æ ·å¼ */
        .login-form {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(0, 10, 30, 0.7);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #1976d2;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        
        input:focus {
            outline: none;
            border-color: #4fc3f7;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #2196f3, #1976d2);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: linear-gradient(to right, #1976d2, #0d47a1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* æ¸¸æˆé¡µé¢æ ·å¼ */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 15px 20px;
            background: rgba(0, 20, 40, 0.7);
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: rgba(25, 118, 210, 0.3);
            padding: 12px 16px;
            border-radius: 10px;
            text-align: center;
            min-width: 100px;
            flex: 1;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffcc00;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 800px;
            justify-content: center;
        }
        
        .card {
            aspect-ratio: 2/3;
            background: linear-gradient(135deg, #1976d2, #0d47a1);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            position: relative;
            min-height: 100px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .card.flipped {
            background: linear-gradient(135deg, #fbc02d, #f57f17);
            transform: rotateY(180deg);
        }
        
        .card.bomb {
            background: linear-gradient(135deg, #f44336, #b71c1c);
        }
        
        .card.reward {
            background: linear-gradient(135deg, #4caf50, #1b5e20);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
        }
        
        .card-front {
            background: linear-gradient(135deg, #1976d2, #0d47a1);
        }
        
        .card-back {
            background: linear-gradient(135deg, #fbc02d, #f57f17);
            transform: rotateY(180deg);
        }
        
        .card-value {
            color: white;
            font-size: 16px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .btn-game {
            padding: 14px 30px;
            font-size: 18px;
            min-width: 180px;
        }
        
        .btn-stop {
            background: linear-gradient(to right, #f44336, #d32f2f);
        }
        
        .btn-stop:hover {
            background: linear-gradient(to right, #d32f2f, #b71c1c);
        }
        
        .message {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            min-height: 40px;
            color: #ffcc00;
        }
        
        /* ç®¡ç†å‘˜é¡µé¢æ ·å¼ */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .admin-stat {
            background: rgba(25, 118, 210, 0.2);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .admin-stat h3 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .admin-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffcc00;
        }
        
        .admin-label {
            font-size: 1.1rem;
            color: #90caf9;
            margin-top: 10px;
        }
        
        .admin-note {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            background: rgba(255, 0, 0, 0.1);
            border-radius: 10px;
            color: #ffcc00;
            font-size: 1.1rem;
        }
        
        /* ç‰¹æ•ˆæ ·å¼ */
        .explosion-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            color: #ff4444;
            z-index: 1000;
            animation: explode 1.5s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes explode {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }
        
        .coin-effect {
            position: fixed;
            font-size: 30px;
            color: #ffd700;
            animation: coinFlyToTarget 1s ease-out forwards;
            pointer-events: none;
            z-index: 999;
        }
        
        @keyframes coinFlyToTarget {
            0% {
                transform: translateY(0) translateX(0) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(-50px) translateX(0) scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-120px) translateX(var(--target-x, 0)) scale(0.3);
                opacity: 0;
            }
        }
        
        .number-roll {
            animation: rollUp 0.5s ease-out;
        }
        
        .number-fall {
            animation: rollDown 0.5s ease-out;
        }
        
        @keyframes rollUp {
            0% {
                transform: translateY(20px);
                opacity: 0.5;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes rollDown {
            0% {
                transform: translateY(-20px);
                opacity: 1;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* ç¡®è®¤å¯¹è¯æ¡†æ ·å¼ */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .dialog-content {
            background: rgba(0, 20, 40, 0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .dialog-content h3 {
            color: #ffcc00;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .dialog-content p {
            color: #fff;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }
        
        .dialog-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .dialog-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .dialog-btn.confirm {
            background: linear-gradient(to right, #f44336, #d32f2f);
            color: white;
        }
        
        .dialog-btn.cancel {
            background: linear-gradient(to right, #2196f3, #1976d2);
            color: white;
        }
        
        .dialog-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* è½®æ¬¡ç‰¹æ•ˆæ ·å¼ */
        .round-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            font-weight: bold;
            color: #ffcc00;
            z-index: 1000;
            animation: roundShow 2s ease-out forwards;
            pointer-events: none;
            text-shadow: 0 0 20px rgba(255, 204, 0, 0.8);
        }
        
        @keyframes roundShow {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            30% {
                transform: translate(-50%, -50%) scale(1.3);
                opacity: 1;
            }
            70% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }
        
        /* ç”¨æˆ·æ•°æ®è¡¨æ ¼æ ·å¼ */
        .user-data-section {
            margin: 30px 0;
        }
        
        .user-data-table {
            background: rgba(0, 20, 40, 0.7);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            padding: 15px 20px;
            background: rgba(25, 118, 210, 0.3);
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .table-body {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .user-row {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1fr 1fr 1fr 1fr;
            gap: 10px;
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            transition: background-color 0.3s ease;
        }
        
        .user-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .user-row:last-child {
            border-bottom: none;
        }
        
        .delete-user-btn {
            padding: 5px 10px;
            background: linear-gradient(to right, #f44336, #d32f2f);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .delete-user-btn:hover {
            background: linear-gradient(to right, #d32f2f, #b71c1c);
            transform: translateY(-1px);
        }
        
        /* æ¸¸æˆè§„åˆ™é¡µé¢æ ·å¼ */
        .rules-content {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 20, 40, 0.7);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        .rules-section {
            margin-bottom: 30px;
        }
        
        .rules-section h2 {
            color: #4fc3f7;
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rules-section p, .rules-section li {
            color: #fff;
            line-height: 1.6;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .rules-section ul {
            padding-left: 20px;
        }
        
        .highlight {
            color: #ff4444;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 68, 68, 0.5);
        }
        
        /* åŸºé‡‘å¥–åŠ±ç‰¹æ•ˆæ ·å¼ */
        .fund-bonus-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffd700, #ff8f00);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            z-index: 2000;
            text-align: center;
            animation: fundBonusShow 3s ease-out forwards;
            pointer-events: none;
        }
        
        .fund-bonus-effect h2 {
            color: #1a1a1a;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .fund-bonus-effect .amount {
            font-size: 4rem;
            font-weight: bold;
            color: #d32f2f;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
            margin-bottom: 20px;
        }
        
        .fund-bonus-effect p {
            color: #424242;
            font-size: 1.2rem;
        }
        
        @keyframes fundBonusShow {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }
        
        /* æƒ©ç½šç‰¹æ•ˆæ ·å¼ */
        .penalty-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ff4444, #d32f2f);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.8);
            z-index: 2000;
            text-align: center;
            animation: penaltyShow 2.5s ease-out forwards;
            pointer-events: none;
        }
        
        .penalty-effect h2 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .penalty-effect .amount {
            font-size: 3.5rem;
            font-weight: bold;
            color: #ffff8d;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
            margin-bottom: 20px;
        }
        
        .penalty-effect p {
            color: #ffcccb;
            font-size: 1.2rem;
        }
        
        @keyframes penaltyShow {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: repeat(4, 1fr);
                max-width: 400px;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .stat-box {
                min-width: auto;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .btn-game {
                width: 100%;
                max-width: 300px;
            }
            
            .table-header, .user-row {
                grid-template-columns: 2fr 1fr 1fr 1fr;
                font-size: 12px;
            }
            
            .table-header div:nth-child(n+5),
            .user-row div:nth-child(n+5) {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .game-board {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }
            
            .stats {
                gap: 8px;
            }
            
            .stat-box {
                padding: 10px 12px;
            }
            
            .stat-value {
                font-size: 20px;
            }
            
            .card {
                min-height: 60px;
                font-size: 1rem;
            }
            
            .card-value {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•é¡µé¢ -->
        <div id="login-page" class="page active">
            <h1>ç‚¸å¼¹ç¿»ç‰Œæ¸¸æˆ</h1>
            <div class="login-form">
                <div class="form-group">
                    <label for="username">ç”¨æˆ·å</label>
                    <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç </label>
                    <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
                </div>
                <div class="form-group" id="confirm-password-group" style="display: none;">
                    <label for="confirm-password">ç¡®è®¤å¯†ç </label>
                    <input type="password" id="confirm-password" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                </div>
                <div id="error-message" style="color: #ff4444; text-align: center; margin: 10px 0; min-height: 20px;"></div>
                <button id="login-btn" class="btn">ç™»å½•æ¸¸æˆ</button>
                <button id="register-btn" class="btn" style="background: linear-gradient(to right, #4caf50, #388e3c); margin-top: 15px;">
                    æ³¨å†Œè´¦å·
                </button>
            </div>
        </div>
        
        <!-- æ¸¸æˆè§„åˆ™ä»‹ç»é¡µé¢ -->
        <div id="rules-page" class="page">
            <h1>æ¸¸æˆè§„åˆ™ä»‹ç»</h1>
            <div class="rules-content">
                <div class="rules-section">
                    <h2>ğŸ¯ æ¸¸æˆç›®æ ‡</h2>
                    <p>åœ¨ç¿»ç‰Œæ¸¸æˆä¸­è·å¾—å°½å¯èƒ½å¤šçš„å¥–é‡‘ï¼ŒåŒæ—¶é¿å…è§¦ç¢°ç‚¸å¼¹ã€‚</p>
                </div>
                
                <div class="rules-section">
                    <h2>ğŸƒ æ¸¸æˆè§„åˆ™</h2>
                    <ul>
                        <li><strong>å¡ç‰‡è®¾ç½®ï¼š</strong>æ¯è½®å›ºå®šæœ‰16å¼ å¡ç‰‡ï¼ŒåŒ…å«å¥–åŠ±å¡å’Œç‚¸å¼¹å¡</li>
                        <li><strong>å¥–åŠ±å¡ï¼š</strong>é‡‘é¢ä»Â¥100åˆ°Â¥10,000ä¸ç­‰</li>
                        <li><strong>æ¸¸æˆè´¹ç”¨ï¼š</strong>æ¯è½®æ¸¸æˆéœ€è¦æ”¯ä»˜Â¥200</li>
                        <li><strong>å¥–é‡‘ç´¯ç§¯ï¼š</strong>æ¯è½®æˆåŠŸè·å¾—çš„å¥–é‡‘ä¼šç´¯åŠ åˆ°æ€»å¥–é‡‘ä¸­</li>
                    </ul>
                </div>
                
                <div class="rules-section">
                    <h2>ğŸ’£ ç‚¸å¼¹æœºåˆ¶</h2>
                    <ul>
                        <li>è§¦ç¢°åˆ°ç‚¸å¼¹å°†<span class="highlight">éšæœºæ‰£é™¤Â¥100-2000</span></li>
                        <li>ç‚¸å¼¹æ•°é‡æ¯è½®éšæœº</li>
                        <li>å¯ä»¥éšæ—¶é€‰æ‹©"ç»“æŸæœ¬è½®"æ¥ä¿æŠ¤å·²è·å¾—çš„å¥–é‡‘</li>
                    </ul>
                </div>
                
                <div class="rules-section">
                    <h2>ğŸ’° å¥–é‡‘è¯´æ˜</h2>
                    <ul>
                        <li><strong>é¦–æ¬¡æ³¨å†Œå¥–åŠ±ï¼š</strong>æ–°ç”¨æˆ·è·å¾—Â¥2,000èµ·å§‹åŸºé‡‘</li>
                        <li><strong>å¥–é‡‘ä¿æŠ¤ï¼š</strong>ä¸»åŠ¨ç»“æŸæœ¬è½®å¯ä¿ç•™å½“è½®å¥–é‡‘</li>
                        <li><strong>ç‰¹æ®Šå¥–åŠ±ï¼š</strong><span class="highlight">æ€»å¥–é‡‘ç´¯è®¡Â¥50,000å¯è·å¾—ä¸€ä»½ç²¾ç¾ç¤¼å“ï¼</span></li>
                    </ul>
                </div>
                
                <div class="rules-section">
                    <h2>ğŸ® æ“ä½œè¯´æ˜</h2>
                    <ul>
                        <li>ç‚¹å‡»å¡ç‰‡è¿›è¡Œç¿»ç‰Œ</li>
                        <li>éšæ—¶å¯ä»¥ç‚¹å‡»"ç»“æŸæœ¬è½®"ä»¥ç»“æŸæ¸¸æˆ</li>
                        <li>16å¼ å¡ç‰Œè¢«ç¿»å®Œåè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€è½®</li>
                    </ul>
                </div>
            </div>
            
            <div class="controls">
                <button id="exit-to-login-btn" class="btn btn-game" style="background: linear-gradient(to right, #9e9e9e, #616161);">
                    é€€å‡ºæ¸¸æˆ
                </button>
                <button id="enter-game-btn" class="btn btn-game" style="background: linear-gradient(to right, #4caf50, #388e3c);">
                    è¿›å…¥æ¸¸æˆ
                </button>
            </div>
        </div>
        
        <!-- æ¸¸æˆé¡µé¢ -->
        <div id="game-page" class="page">
            <h1>ç‚¸å¼¹ç¿»ç‰ŒæŒ‘æˆ˜</h1>
            <div class="game-header">
                <div class="stats">
                    <div class="stat-box">
                        <div>å½“å‰ä½™é¢</div>
                        <div id="total-bonus" class="stat-value">Â¥0</div>
                    </div>
                    <div class="stat-box">
                        <div>æœ¬è½®å¥–é‡‘</div>
                        <div id="current-bonus" class="stat-value">Â¥0</div>
                    </div>
                    <div class="stat-box">
                        <div>å·²ç¿»ç‰Œæ•°</div>
                        <div id="flipped-count" class="stat-value">0</div>
                    </div>
                    <div class="stat-box">
                        <div>å‰©ä½™ç‰Œæ•°</div>
                        <div id="remaining-cards" class="stat-value">16</div>
                    </div>
                </div>
            </div>
            
            <div class="message" id="game-message">ç‚¹å‡»å¡ç‰‡å¼€å§‹æ¸¸æˆï¼</div>
            
            <div class="game-board" id="game-board">
                <!-- å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="controls">
                <button id="start-game-btn" class="btn btn-game" style="background: linear-gradient(to right, #4caf50, #388e3c);">å¼€å§‹æ¸¸æˆ</button>
                <button id="stop-round-btn" class="btn btn-game btn-stop" style="display: none;">ç»“æŸæœ¬è½®</button>
                <button id="exit-game-btn" class="btn btn-game" style="background: linear-gradient(to right, #9e9e9e, #616161);">é€€å‡ºæ¸¸æˆ</button>
            </div>
        </div>
        
        <!-- ç®¡ç†å‘˜é¡µé¢ -->
        <div id="admin-page" class="page">
            <h1>æ¸¸æˆæ•°æ®ç»Ÿè®¡</h1>
            
            <div class="admin-note">
                æ­¤é¡µé¢ä»…ç®¡ç†å‘˜å¯è§ï¼Œæ˜¾ç¤ºæ¸¸æˆå…¨å±€ç»Ÿè®¡æ•°æ®
            </div>
            
            <div class="admin-stats">
                <div class="admin-stat">
                    <h3>ç¿»ç‰Œæ€»æ•°</h3>
                    <div id="total-flips" class="admin-value">0</div>
                    <div class="admin-label">æ‰€æœ‰ç©å®¶ç¿»ç‰Œæ€»æ¬¡æ•°</div>
                </div>
                
                <div class="admin-stat">
                    <h3>æå‰é€€å‡ºç‡</h3>
                    <div id="early-exit-rate" class="admin-value">0%</div>
                    <div class="admin-label">ç©å®¶ä¸»åŠ¨åœæ­¢æ¸¸æˆçš„æ¯”ä¾‹</div>
                </div>
                
                <div class="admin-stat">
                    <h3>æ”¶ç›Šåç¦»åº¦</h3>
                    <div id="profit-deviation" class="admin-value">0.00</div>
                    <div class="admin-label">å®é™…æ”¶ç›Šä¸æœŸæœ›æ”¶ç›Šçš„åå·®</div>
                </div>
                
                <div class="admin-stat">
                    <h3>é£é™©ä¼°è®¡è¯¯å·®</h3>
                    <div id="risk-error" class="admin-value">0.00</div>
                    <div class="admin-label">ç©å®¶é£é™©é¢„æµ‹çš„è¯¯å·®ç‡</div>
                </div>
                
                <div class="admin-stat">
                    <h3>ç‚¸å¼¹è§¦å‘ç‡</h3>
                    <div id="bomb-rate" class="admin-value">0%</div>
                    <div class="admin-label">ç‚¸å¼¹è¢«ç¿»å‡ºçš„æ¦‚ç‡</div>
                </div>
                
                <div class="admin-stat">
                    <h3>æ¸¸æˆæ€»åœºæ¬¡</h3>
                    <div id="total-games" class="admin-value">0</div>
                    <div class="admin-label">å·²è¿›è¡Œçš„æ¸¸æˆæ€»æ¬¡æ•°</div>
                </div>
            </div>
            
            <!-- ç”¨æˆ·è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
            <div class="user-data-section">
                <h2 style="color: #4fc3f7; margin: 30px 0 20px 0;">ç”¨æˆ·è¯¦ç»†æ•°æ®</h2>
                <div class="user-data-table">
                    <div class="table-header">
                        <div>ç”¨æˆ·å</div>
                        <div>ç¿»ç‰Œæ€»æ•°</div>
                        <div>æå‰é€€å‡ºç‡</div>
                        <div>æ”¶ç›Šåç¦»åº¦</div>
                        <div>é£é™©ä¼°è®¡è¯¯å·®</div>
                        <div>ç‚¸å¼¹è§¦å‘ç‡</div>
                        <div>æ“ä½œ</div>
                    </div>
                    <div id="user-data-list" class="table-body">
                        <!-- ç”¨æˆ·æ•°æ®å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button id="clear-all-data-btn" class="btn btn-game" style="background: linear-gradient(to right, #ff5722, #d84315);">
                    æ¸…ç©ºæ‰€æœ‰æ•°æ®
                </button>
                <button id="logout-btn" class="btn btn-game" style="background: linear-gradient(to right, #f44336, #d32f2f);">
                    é€€å‡ºç™»å½•
                </button>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤å¯¹è¯æ¡† -->
    <div id="confirm-dialog" class="confirm-dialog" style="display: none;">
        <div class="dialog-content">
            <h3>ç¡®è®¤é€€å‡ºæœ¬è½®ï¼Ÿ</h3>
            <p id="remaining-reward-text">è¿˜æœ‰XXXå…ƒå¥–åŠ±æœªç¿»å‡º</p>
            <div class="dialog-buttons">
                <button id="dialog-cancel" class="dialog-btn cancel">ç»§ç»­æ¸¸æˆ</button>
                <button id="dialog-confirm" class="dialog-btn confirm">ç¡®å®šé€€å‡º</button>
            </div>
        </div>
    </div>

    <!-- ä»˜è´¹ç¡®è®¤å¯¹è¯æ¡† -->
    <div id="payment-dialog" class="confirm-dialog" style="display: none;">
        <div class="dialog-content">
            <h3>å¼€å§‹æ–°æ¸¸æˆ</h3>
            <p id="payment-text">æœ¬è½®æ¸¸æˆéœ€è¦æ”¯ä»˜Â¥200ï¼Œç¡®å®šå¼€å§‹å—ï¼Ÿ</p>
            <p style="color: #4fc3f7; font-size: 0.9rem; margin-top: 10px;">å½“å‰ä½™é¢ï¼š<span id="current-balance">Â¥0</span></p>
            <div class="dialog-buttons">
                <button id="payment-cancel" class="dialog-btn cancel">å–æ¶ˆ</button>
                <button id="payment-confirm" class="dialog-btn confirm">ç¡®å®šæ”¯ä»˜</button>
            </div>
        </div>
    </div>

    <script>
        // ç‰ˆæœ¬ä¿¡æ¯ - 2025-08-12 Backend Connected
        console.log('æ¸¸æˆç‰ˆæœ¬: 2025-08-12 - åç«¯è¿æ¥ç‰ˆæœ¬');
        
        // APIé…ç½® - æ ¹æ®ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢
        const getAPIBaseURL = () => {
            // å¦‚æœæ˜¯localhostï¼Œä½¿ç”¨æœ¬åœ°å¼€å‘ç¯å¢ƒ
            if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                return 'http://localhost:3000/api';
            }
            // ç”Ÿäº§ç¯å¢ƒ - ä½¿ç”¨å›ºå®šåŸŸå
            const fixedURL = 'https://bomb-card-game-backend.vercel.app/api';
            console.log('ä½¿ç”¨å›ºå®šAPIåœ°å€:', fixedURL);
            return fixedURL;
        };
        
        const API_BASE_URL = getAPIBaseURL();
        
        // APIç®¡ç†ç±»
        class GameAPI {
            constructor() {
                this.token = localStorage.getItem('authToken');
                this.baseURL = API_BASE_URL;
            }
            
            // è®¾ç½®è®¤è¯token
            setToken(token) {
                console.log('è®¾ç½®Token:', token);
                this.token = token;
                localStorage.setItem('authToken', token);
            }
            
            // æ¸…é™¤token
            clearToken() {
                this.token = null;
                localStorage.removeItem('authToken');
            }
            
            // é€šç”¨è¯·æ±‚æ–¹æ³•
            async request(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                const config = {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                };
                
                // æ·»åŠ è®¤è¯å¤´
                if (this.token) {
                    config.headers.Authorization = `Bearer ${this.token}`;
                    console.log('å·²æ·»åŠ Authorizationå¤´');
                }
                
                try {
                    console.log('å‘é€APIè¯·æ±‚:', url, config);
                    const response = await fetch(url, config);
                    
                    if (!response.ok) {
                        console.error('HTTPé”™è¯¯çŠ¶æ€:', response.status, response.statusText);
                        let errorMessage;
                        try {
                            const errorData = await response.json();
                            errorMessage = errorData.message || `HTTP ${response.status}: ${response.statusText}`;
                        } catch (e) {
                            errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                        }
                        throw new Error(errorMessage);
                    }
                    
                    const data = await response.json();
                    console.log('APIå“åº”æˆåŠŸ:', data);
                    return data;
                } catch (error) {
                    console.error('APIè¯·æ±‚é”™è¯¯:', error);
                    if (error.name === 'TypeError' && error.message.includes('fetch')) {
                        throw new Error('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•');
                    }
                    throw error;
                }
            }
            
            // ç”¨æˆ·ç™»å½•
            async login(username, password) {
                return this.request('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });
            }
            
            // ç”¨æˆ·æ³¨å†Œ
            async register(username, password) {
                return this.request('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });
            }
            
            // è·å–ç”¨æˆ·ä¿¡æ¯
            async getUserInfo() {
                return this.request('/user/info');
            }
            
            // æ›´æ–°ä½™é¢
            async updateBalance(newBalance) {
                return this.request('/user/balance', {
                    method: 'PUT',
                    body: JSON.stringify({ balance: newBalance })
                });
            }
            
            // è®°å½•æ¸¸æˆä¼šè¯
            async recordSession(sessionData) {
                return this.request('/game/session', {
                    method: 'POST',
                    body: JSON.stringify(sessionData)
                });
            }
            
            // è®°å½•æ¸¸æˆè½®æ¬¡
            async recordRound(roundData) {
                return this.request('/game/round', {
                    method: 'POST',
                    body: JSON.stringify(roundData)
                });
            }
            
            // è®°å½•é£é™©ä¼°è®¡æ•°æ®
            async recordRiskEstimation(data) {
                return this.request('/game/risk-estimation', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
            }
            
            // è·å–ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®
            async getAdminStats() {
                return this.request('/admin/stats');
            }
            
            // è·å–æ‰€æœ‰ç”¨æˆ·æ•°æ®
            async getAllUsers() {
                return this.request('/admin/users');
            }
            
            // è·å–ç”¨æˆ·è¯¦æƒ…
            async getUserDetail(userId) {
                return this.request(`/admin/users/${userId}`);
            }
            
            // åˆ é™¤ç”¨æˆ·
            async deleteUser(userId) {
                return this.request(`/admin/users/${userId}`, {
                    method: 'DELETE'
                });
            }
            
            // æ¸…ç©ºæ‰€æœ‰æ•°æ®
            async clearAllData() {
                return this.request('/admin/data/clear', {
                    method: 'DELETE'
                });
            }
        }
        
        // åˆ›å»ºAPIå®ä¾‹
        const gameAPI = new GameAPI();
        
        // æ·»åŠ ç”¨æˆ·ä¿¡æ¯æ›´æ–°å‡½æ•°
        async function refreshUserInfoBalanceSafe() {
            try {
                const userInfo = await gameAPI.getUserInfo();
                gameData.userInfo = userInfo;
                gameData.totalBonus = userInfo.data.current_balance || 2000;
                console.log('ç”¨æˆ·ä¿¡æ¯åˆ·æ–°æˆåŠŸï¼Œå½“å‰ä½™é¢:', gameData.totalBonus);
                return true;
            } catch (error) {
                console.error('åˆ·æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                return false;
            }
        }
        
        // æ›´æ–°æ¸¸æˆé¡µé¢ä½™é¢æ˜¾ç¤º
        async function updateGamePageBalance() {
            try {
                await refreshUserInfoBalanceSafe();
                if (totalBonusEl) {
                    totalBonusEl.textContent = `Â¥${gameData.totalBonus.toLocaleString()}`;
                }
                console.log('æ¸¸æˆé¡µé¢ä½™é¢å·²æ›´æ–°:', gameData.totalBonus);
            } catch (error) {
                console.error('æ›´æ–°æ¸¸æˆé¡µé¢ä½™é¢å¤±è´¥:', error);
            }
        }
        
        // æ¸¸æˆæ•°æ®
        const gameData = {
            // å¡ç‰‡é…ç½®
            cards: [],
            rewards: [100, 200, 300, 500, 800, 1000, 1500, 2000, 2500, 3000, 5000, 10000],
            bombCount: 0, // å°†åœ¨æ¸¸æˆå¼€å§‹æ—¶éšæœºç”Ÿæˆ
            
            // æ¸¸æˆçŠ¶æ€
            totalBonus: 0,
            currentRoundBonus: 0,
            flippedCount: 0,
            gameActive: false,
            roundEnded: false,
            currentPlayerSession: null,
            currentSessionId: null, // å½“å‰æ¸¸æˆä¼šè¯ID
            currentUser: null,
            isRegistering: false,
            roundCost: 200, // æ¯è½®æ¸¸æˆè´¹ç”¨
            
            // ç”¨æˆ·ä¿¡æ¯ï¼ˆä»åç«¯è·å–ï¼‰
            userInfo: null,
            
            // ç»Ÿè®¡æ•°æ®ï¼ˆç®¡ç†å‘˜å¯è§ï¼Œä¿æŒå‘åå…¼å®¹ï¼‰
            stats: {
                totalFlips: 0,
                gamesPlayed: 0,
                roundsPlayed: 0,
                earlyExits: 0,
                bombTriggers: 0,
                totalPossibleReward: 0,
                totalActualReward: 0,
                riskEstimations: [],
                averageCardsFlippedPerRound: 0
            },
            
            // ç©å®¶ä¼šè¯æ•°æ®ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰
            playerSessions: JSON.parse(localStorage.getItem('cardGameSessions') || '[]')
        };
        
        // DOMå…ƒç´ 
        const loginPage = document.getElementById('login-page');
        const rulesPage = document.getElementById('rules-page');
        const gamePage = document.getElementById('game-page');
        const adminPage = document.getElementById('admin-page');
        const gameBoard = document.getElementById('game-board');
        const totalBonusEl = document.getElementById('total-bonus');
        const currentBonusEl = document.getElementById('current-bonus');
        const flippedCountEl = document.getElementById('flipped-count');
        const remainingCardsEl = document.getElementById('remaining-cards');
        const gameMessageEl = document.getElementById('game-message');
        
        // ç®¡ç†å‘˜æ•°æ®å…ƒç´ 
        const totalFlipsEl = document.getElementById('total-flips');
        const earlyExitRateEl = document.getElementById('early-exit-rate');
        const profitDeviationEl = document.getElementById('profit-deviation');
        const riskErrorEl = document.getElementById('risk-error');
        const bombRateEl = document.getElementById('bomb-rate');
        const totalGamesEl = document.getElementById('total-games');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            gameData.currentPlayerSession = {
                username: gameData.currentUser,
                startTime: Date.now(),
                rounds: [],
                totalFlips: 0,
                totalBombHits: 0,
                totalRewards: 0
            };
            
            // ä¸ºé¦–æ¬¡ç™»å½•ç”¨æˆ·è®¾ç½®åˆå§‹åŸºé‡‘
            if (gameData.currentUser && gameData.users[gameData.currentUser] && 
                gameData.users[gameData.currentUser].isFirstLogin) {
                gameData.totalBonus = 2000;
                gameData.users[gameData.currentUser].isFirstLogin = false;
                saveUserData();
                
                // ç«‹å³æ˜¾ç¤º2000å…ƒå¥–é‡‘åˆ°è´¦å¼¹çª—
                setTimeout(() => {
                    showNewUserBonusDialog();
                }, 500);
            } else {
                // åŠ è½½ç”¨æˆ·å½“å‰ä½™é¢
                if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                    gameData.totalBonus = gameData.users[gameData.currentUser].stats.totalRewards;
                }
                // æ˜¾ç¤ºæ¸¸æˆå‡†å¤‡çŠ¶æ€
                showGameReadyState();
            }
        }
        
        // æ˜¾ç¤ºæ¸¸æˆå‡†å¤‡çŠ¶æ€
        function showGameReadyState() {
            // ç¡®ä¿åŠ è½½ç”¨æˆ·å½“å‰ä½™é¢
            if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                gameData.totalBonus = gameData.users[gameData.currentUser].stats.totalRewards;
            }
            
            // æ›´æ–°ä½™é¢æ˜¾ç¤º
            totalBonusEl.textContent = `Â¥${gameData.totalBonus.toLocaleString()}`;
            currentBonusEl.textContent = 'Â¥0';
            flippedCountEl.textContent = '0';
            remainingCardsEl.textContent = '16';
            
            // æ˜¾ç¤ºå¼€å§‹æ¸¸æˆæŒ‰é’®ï¼Œéšè—ç»“æŸæœ¬è½®æŒ‰é’®
            document.getElementById('start-game-btn').style.display = 'inline-block';
            document.getElementById('stop-round-btn').style.display = 'none';
            
            // æ¸…ç©ºæ¸¸æˆåŒºåŸŸ
            gameBoard.innerHTML = '';
            gameMessageEl.textContent = 'ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"å¼€å§‹æ–°çš„ä¸€è½®ï¼';
            gameMessageEl.style.color = '#ffcc00';
            
            // é‡ç½®æ¸¸æˆæ•°æ®
            gameData.gameActive = false;
            gameData.roundEnded = false;
            gameData.flippedCount = 0;
            gameData.currentRoundBonus = 0;
        }
        
        // å¼€å§‹æ–°ä¸€è½®æ¸¸æˆ
        function startNewRound() {
            // æ‰£é™¤è´¹ç”¨
            gameData.totalBonus -= gameData.roundCost;
            gameData.currentRoundBonus = 0;
            gameData.flippedCount = 0;
            gameData.gameActive = true;
            gameData.roundEnded = false;
            
            // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡ - æ–°æ¸¸æˆå¼€å§‹
            if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                gameData.users[gameData.currentUser].stats.gamesPlayed++;
                gameData.users[gameData.currentUser].stats.totalRewards = gameData.totalBonus;
            }
            
            // æ›´æ–°UI
            totalBonusEl.textContent = `Â¥${gameData.totalBonus.toLocaleString()}`;
            currentBonusEl.textContent = 'Â¥0';
            flippedCountEl.textContent = '0';
            remainingCardsEl.textContent = '16';
            gameMessageEl.textContent = 'ç‚¹å‡»å¡ç‰‡å¼€å§‹ç¿»ç‰Œï¼';
            gameMessageEl.style.color = '#ffcc00';
            
            // æ˜¾ç¤ºç»“æŸæœ¬è½®æŒ‰é’®ï¼Œéšè—å¼€å§‹æ¸¸æˆæŒ‰é’®
            document.getElementById('start-game-btn').style.display = 'none';
            document.getElementById('stop-round-btn').style.display = 'inline-block';
            
            // åˆ›å»ºå¡ç‰‡
            createCards();
        }
        
        // åˆ›å»ºå¡ç‰‡
        function createCards() {
            gameBoard.innerHTML = '';
            gameData.cards = [];
            
            // éšæœºç”Ÿæˆç‚¸å¼¹æ•°é‡ï¼ˆ1-10ä¸ªï¼‰
            gameData.bombCount = Math.floor(Math.random() * 10) + 1;
            
            // åˆ›å»ºç‚¸å¼¹å¡ç‰‡
            for (let i = 0; i < gameData.bombCount; i++) {
                gameData.cards.push({
                    type: 'bomb',
                    value: 0,
                    flipped: false
                });
            }
            
            // åˆ›å»ºå¥–åŠ±å¡ç‰‡ - ç¡®ä¿æ€»å…±16å¼ å¡ç‰‡
            const rewardCardCount = 16 - gameData.bombCount;
            
            // æ·»åŠ åŸºç¡€å¥–åŠ±å¡ç‰‡
            let addedRewards = 0;
            gameData.rewards.forEach(reward => {
                if (addedRewards < rewardCardCount) {
                    gameData.cards.push({
                        type: 'reward',
                        value: reward,
                        flipped: false
                    });
                    addedRewards++;
                }
            });
            
            // å¦‚æœè¿˜éœ€è¦æ›´å¤šå¥–åŠ±å¡ç‰‡ï¼Œæ·»åŠ å°é¢å¥–åŠ±å¡
            while (gameData.cards.length < 16) {
                gameData.cards.push({
                    type: 'reward',
                    value: 50, // å°é¢å¥–åŠ±
                    flipped: false
                });
            }
            
            // ç¡®ä¿æ­£å¥½16å¼ å¡ç‰‡
            gameData.cards = gameData.cards.slice(0, 16);
            
            // æ´—ç‰Œ
            shuffleCards();
            
            // æ¸²æŸ“å¡ç‰‡
            gameData.cards.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.innerHTML = `
                    <div class="card-front">?</div>
                    <div class="card-back">
                        <div class="card-value">${card.type === 'reward' ? 'Â¥' + card.value : 'ğŸ’£'}</div>
                    </div>
                `;
                
                cardEl.addEventListener('click', () => flipCard(index));
                gameBoard.appendChild(cardEl);
            });
            
            // æ›´æ–°å‰©ä½™å¡ç‰‡æ•°æ˜¾ç¤º
            remainingCardsEl.textContent = '16';
        }
        
        // æ´—ç‰Œç®—æ³•
        function shuffleCards() {
            for (let i = gameData.cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameData.cards[i], gameData.cards[j]] = [gameData.cards[j], gameData.cards[i]];
            }
        }
        
        // ç¿»ç‰Œ
        function flipCard(index) {
            if (!gameData.gameActive || gameData.roundEnded || gameData.cards[index].flipped) return;
            
            const card = gameData.cards[index];
            card.flipped = true;
            gameData.flippedCount++;
            
            // åªæ›´æ–°å½“å‰ç”¨æˆ·çš„æ¸¸æˆä¼šè¯æ•°æ®
            gameData.currentPlayerSession.totalFlips++;
            
            // æ›´æ–°ç”¨æˆ·ç¿»ç‰Œç»Ÿè®¡
            if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                gameData.users[gameData.currentUser].stats.totalFlips++;
            }
            
            // æ›´æ–°UI
            flippedCountEl.textContent = gameData.flippedCount;
            remainingCardsEl.textContent = 16 - gameData.flippedCount;
            
            const cardEl = gameBoard.children[index];
            cardEl.classList.add('flipped');
            
            // å¤„ç†å¡ç‰‡ç±»å‹
            if (card.type === 'reward') {
                cardEl.classList.add('reward');
                gameData.currentRoundBonus += card.value;
                
                // æ˜¾ç¤ºé‡‘å¸ç‰¹æ•ˆ
                showCoinEffect(cardEl);
                
                // å»¶è¿Ÿæ›´æ–°é‡‘é¢ä»¥é…åˆç‰¹æ•ˆ
                setTimeout(() => {
                    animateNumberRoll(currentBonusEl, `Â¥${gameData.currentRoundBonus.toLocaleString()}`, true);
                }, 300);
                
                gameMessageEl.textContent = `æ­å–œï¼è·å¾— Â¥${card.value.toLocaleString()} å¥–åŠ±ï¼`;
                gameMessageEl.style.color = '#4caf50';
                
                // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¥–åŠ±å¡éƒ½å·²ç¿»å¼€
                const allRewardsFlipped = gameData.cards.filter(c => 
                    c.type === 'reward' && !c.flipped).length === 0;
                
                if (allRewardsFlipped) {
                    setTimeout(() => {
                        endRound('win');
                    }, 800);
                }
            } else {
                cardEl.classList.add('bomb');
                
                // åªæ›´æ–°å½“å‰ç”¨æˆ·çš„æ¸¸æˆä¼šè¯æ•°æ®
                gameData.currentPlayerSession.totalBombHits++;
                
                // æ›´æ–°ç”¨æˆ·ç‚¸å¼¹è§¦å‘ç»Ÿè®¡
                if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                    gameData.users[gameData.currentUser].stats.bombTriggers++;
                }
                
                // æ˜¾ç¤ºçˆ†ç‚¸ç‰¹æ•ˆ
                showExplosionEffect();
                
                // ç”Ÿæˆéšæœºæƒ©ç½šé‡‘é¢ï¼ˆ100-2000ï¼‰
                const penaltyAmount = Math.floor(Math.random() * 1901) + 100;
                
                // æ‰£é™¤æƒ©ç½šé‡‘é¢
                gameData.totalBonus -= penaltyAmount;
                if (gameData.totalBonus < 0) {
                    gameData.totalBonus = 0;
                }
                
                setTimeout(() => {
                    // æ˜¾ç¤ºæƒ©ç½šç‰¹æ•ˆ
                    showPenaltyEffect(penaltyAmount);
                    
                    // æ›´æ–°æ˜¾ç¤º
                    animateNumberRoll(totalBonusEl, `Â¥${gameData.totalBonus.toLocaleString()}`, false);
                    
                    gameMessageEl.textContent = `ğŸ’£ ç‚¸å¼¹ï¼æ‰£é™¤æƒ©ç½šé‡‘é¢Â¥${penaltyAmount.toLocaleString()}ï¼Œç»§ç»­ç¿»ç‰Œï¼`;
                    gameMessageEl.style.color = '#f44336';
                }, 500);
            }
            
            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¡ç‰‡éƒ½å·²ç¿»å¼€
            const allCardsFlipped = gameData.cards.filter(c => !c.flipped).length === 0;
            
            if (allCardsFlipped) {
                setTimeout(() => {
                    alert('16å¼ å¡ç‰Œå·²å…¨éƒ¨ç¿»å¼€ï¼Œæ¸¸æˆç»“æŸï¼');
                    
                    gameMessageEl.textContent = `ğŸŠ 16å¼ å¡ç‰Œå·²å…¨éƒ¨ç¿»å¼€ï¼è·å¾—æœ¬è½®å¥–é‡‘ï¼šÂ¥${gameData.currentRoundBonus.toLocaleString()}`;
                    gameMessageEl.style.color = '#4caf50';
                    
                    // æ·»åŠ æœ¬è½®å¥–é‡‘åˆ°æ€»å¥–é‡‘
                    gameData.totalBonus += gameData.currentRoundBonus;
                    animateNumberRoll(totalBonusEl, `Â¥${gameData.totalBonus.toLocaleString()}`, true);
                    
                    // ä¿å­˜æ¸¸æˆæ•°æ®
                    if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                        gameData.users[gameData.currentUser].stats.totalRewards = gameData.totalBonus;
                    }
                    
                    // å°†å½“å‰æ¸¸æˆä¼šè¯æ·»åŠ åˆ°ç”¨æˆ·çš„ç‹¬ç«‹ä¼šè¯è®°å½•å’Œå…¨å±€è®°å½•
                    if (gameData.currentPlayerSession && gameData.currentUser && gameData.users[gameData.currentUser]) {
                        gameData.currentPlayerSession.totalRewards = gameData.totalBonus;
                        const sessionCopy = {...gameData.currentPlayerSession};
                        
                        // æ·»åŠ åˆ°ç”¨æˆ·çš„ç‹¬ç«‹sessionsæ•°ç»„
                        if (!gameData.users[gameData.currentUser].sessions) {
                            gameData.users[gameData.currentUser].sessions = [];
                        }
                        gameData.users[gameData.currentUser].sessions.push(sessionCopy);
                        
                        // ä¹Ÿæ·»åŠ åˆ°å…¨å±€playerSessionsï¼ˆä¸ºäº†å‘åå…¼å®¹ï¼‰
                        gameData.playerSessions.push(sessionCopy);
                    }
                    
                    saveUserData();
                    
                    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç¤¼å“é—¨æ§›
                    if (gameData.totalBonus >= 50000) {
                        setTimeout(() => {
                            alert('ğŸ‰ æ­å–œï¼æ‚¨çš„æ€»å¥–é‡‘å·²è¾¾åˆ°Â¥50,000ï¼Œå¯ä»¥è·å¾—ä¸€ä»½ç²¾ç¾ç¤¼å“ï¼');
                        }, 1000);
                    }
                    
                    // å»¶è¿Ÿåè¿”å›å¼€å§‹æ¸¸æˆç•Œé¢
                    setTimeout(() => {
                        showGameReadyState();
                    }, 2000);
                }, 1000);
            }
            
            // è®°å½•é£é™©ä¼°è®¡æ•°æ®
            recordRiskEstimation();
        }
        
        // è®°å½•é£é™©ä¼°è®¡æ•°æ® - å±äºå½“å‰ç”¨æˆ·
        function recordRiskEstimation() {
            const remainingCards = gameData.cards.filter(c => !c.flipped);
            const remainingBombs = remainingCards.filter(c => c.type === 'bomb').length;
            const remainingRewards = remainingCards.filter(c => c.type === 'reward').length;
            
            if (remainingCards.length > 0 && gameData.currentUser && gameData.users[gameData.currentUser]) {
                const bombProbability = remainingBombs / remainingCards.length;
                
                // ç¡®ä¿ç”¨æˆ·æœ‰é£é™©ä¼°è®¡æ•°ç»„
                if (!gameData.users[gameData.currentUser].riskEstimations) {
                    gameData.users[gameData.currentUser].riskEstimations = [];
                }
                
                gameData.users[gameData.currentUser].riskEstimations.push({
                    actualBombProb: bombProbability,
                    flippedCount: gameData.flippedCount,
                    timestamp: Date.now()
                });
            }
        }
        
        // ç‰¹æ•ˆå‡½æ•°
        function showExplosionEffect() {
            const explosion = document.createElement('div');
            explosion.className = 'explosion-effect';
            explosion.innerHTML = 'ğŸ’¥';
            document.body.appendChild(explosion);
            
            setTimeout(() => {
                document.body.removeChild(explosion);
            }, 1500);
        }
        
        function showCoinEffect(startElement) {
            const coin = document.createElement('div');
            coin.className = 'coin-effect';
            coin.innerHTML = 'ğŸª™';
            
            const startRect = startElement.getBoundingClientRect();
            const targetRect = currentBonusEl.getBoundingClientRect();
            
            // è®¡ç®—ç›®æ ‡ä½ç½®çš„åç§»
            const targetX = targetRect.left - startRect.left;
            coin.style.setProperty('--target-x', targetX + 'px');
            
            coin.style.left = startRect.left + startRect.width / 2 + 'px';
            coin.style.top = startRect.top + startRect.height / 2 + 'px';
            
            document.body.appendChild(coin);
            
            setTimeout(() => {
                if (document.body.contains(coin)) {
                    document.body.removeChild(coin);
                }
            }, 1000);
        }
        
        function animateNumberRoll(element, newValue, isIncrease = true) {
            element.classList.add(isIncrease ? 'number-roll' : 'number-fall');
            element.textContent = newValue;
            
            setTimeout(() => {
                element.classList.remove('number-roll', 'number-fall');
            }, 500);
        }
        
        function showConfirmDialog() {
            const remainingRewards = gameData.cards.filter(c => 
                c.type === 'reward' && !c.flipped);
            const totalRemaining = remainingRewards.reduce((sum, card) => sum + card.value, 0);
            
            document.getElementById('remaining-reward-text').textContent = 
                `è¿˜æœ‰Â¥${totalRemaining.toLocaleString()}å¥–åŠ±æœªç¿»å‡º`;
            document.getElementById('confirm-dialog').style.display = 'flex';
        }
        
        function hideConfirmDialog() {
            document.getElementById('confirm-dialog').style.display = 'none';
        }
        
        function showPaymentDialog() {
            document.getElementById('current-balance').textContent = `Â¥${gameData.totalBonus.toLocaleString()}`;
            
            if (gameData.totalBonus < gameData.roundCost) {
                document.getElementById('payment-text').textContent = 'ä½™é¢ä¸è¶³ï¼Œæ— æ³•å¼€å§‹æ¸¸æˆï¼';
                document.getElementById('payment-confirm').style.display = 'none';
            } else {
                document.getElementById('payment-text').textContent = `æœ¬è½®æ¸¸æˆéœ€è¦æ”¯ä»˜Â¥${gameData.roundCost}ï¼Œç¡®å®šå¼€å§‹å—ï¼Ÿ`;
                document.getElementById('payment-confirm').style.display = 'inline-block';
            }
            
            document.getElementById('payment-dialog').style.display = 'flex';
        }
        
        function hidePaymentDialog() {
            document.getElementById('payment-dialog').style.display = 'none';
            document.getElementById('payment-confirm').style.display = 'inline-block';
        }
        
        // æ–°ç”¨æˆ·å¥–é‡‘åˆ°è´¦å¼¹çª—
        function showNewUserBonusDialog() {
            alert(`ğŸ‰ æ­å–œï¼æ–°ç”¨æˆ·æ³¨å†Œå¥–åŠ±å·²åˆ°è´¦ï¼\n\nğŸ’° å¥–åŠ±é‡‘é¢ï¼šÂ¥2,000\nğŸ’³ å½“å‰ä½™é¢ï¼šÂ¥2,000\n\nç°åœ¨å¯ä»¥å¼€å§‹æ¸¸æˆäº†ï¼æ¯è½®æ¸¸æˆè´¹ç”¨Â¥200`);
            
            // æ˜¾ç¤ºåŸºé‡‘å¥–åŠ±ç‰¹æ•ˆ
            showFundBonusEffect();
            
            // æ˜¾ç¤ºæ¸¸æˆå‡†å¤‡çŠ¶æ€
            setTimeout(() => {
                showGameReadyState();
            }, 3000);
        }
        
        function showFundBonusEffect() {
            const fundEffect = document.createElement('div');
            fundEffect.className = 'fund-bonus-effect';
            fundEffect.innerHTML = `
                <h2>ğŸ‰ é¦–æ¬¡æ³¨å†Œå¥–åŠ± ğŸ‰</h2>
                <div class="amount">Â¥2,000</div>
                <p>æ­å–œè·å¾—æ–°æ‰‹åŸºé‡‘ï¼</p>
            `;
            document.body.appendChild(fundEffect);
            
            setTimeout(() => {
                if (document.body.contains(fundEffect)) {
                    document.body.removeChild(fundEffect);
                }
            }, 3000);
        }
        
        function showPenaltyEffect(penaltyAmount) {
            const penaltyEffect = document.createElement('div');
            penaltyEffect.className = 'penalty-effect';
            penaltyEffect.innerHTML = `
                <h2>ğŸ’£ ç‚¸å¼¹æƒ©ç½š ğŸ’£</h2>
                <div class="amount">-Â¥${penaltyAmount.toLocaleString()}</div>
                <p>æ‰£é™¤æƒ©ç½šé‡‘é¢</p>
            `;
            document.body.appendChild(penaltyEffect);
            
            setTimeout(() => {
                if (document.body.contains(penaltyEffect)) {
                    document.body.removeChild(penaltyEffect);
                }
            }, 2500);
        }
        
        // ç”¨æˆ·ç®¡ç†å‡½æ•°
        function saveUserData() {
            localStorage.setItem('cardGameUsers', JSON.stringify(gameData.users));
            localStorage.setItem('cardGameSessions', JSON.stringify(gameData.playerSessions));
        }
        
        // é€€å‡ºæ¸¸æˆ
        function exitToLogin() {
            if (confirm('ç¡®å®šè¦é€€å‡ºæ¸¸æˆå¹¶è¿”å›ç™»å½•é¡µé¢å—ï¼Ÿæœªè·å¾—çš„å¥–é‡‘å°†ä¼šä¸¢å¤±ï¼')) {
                // è®°å½•æå‰é€€å‡º
                if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                    gameData.users[gameData.currentUser].stats.earlyExits++;
                }
                
                // ä¿å­˜æ•°æ®
                saveUserData();
                
                // è¿”å›ç™»å½•é¡µé¢
                gamePage.classList.remove('active');
                loginPage.classList.add('active');
                
                // æ¸…é™¤è¾“å…¥æ¡†
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('error-message').textContent = '';
            }
        }
        
        function registerUser(username, password) {
            if (gameData.users[username]) {
                return { success: false, message: 'ç”¨æˆ·åå·²å­˜åœ¨' };
            }
            
            gameData.users[username] = {
                password: password,
                created: Date.now(),
                isFirstLogin: true,
                initialFund: 2000,
                sessions: [], // ç”¨æˆ·çš„æ¸¸æˆä¼šè¯å†å²
                riskEstimations: [], // ç”¨æˆ·çš„é£é™©ä¼°è®¡æ•°æ®
                stats: {
                    totalFlips: 0,
                    gamesPlayed: 0,
                    roundsPlayed: 0,
                    earlyExits: 0,
                    bombTriggers: 0,
                    totalRewards: 2000 // åŒ…å«åˆå§‹åŸºé‡‘
                }
            };
            
            saveUserData();
            return { success: true, message: 'æ³¨å†ŒæˆåŠŸ', isNewUser: true };
        }
        
        function loginUser(username, password) {
            if (username === 'admin' && password === 'admin001') {
                return { success: true, isAdmin: true };
            }
            
            if (!gameData.users[username] || gameData.users[username].password !== password) {
                return { success: false, message: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯' };
            }
            
            gameData.currentUser = username;
            return { success: true, isAdmin: false };
        }
        
        // ç»“æŸå½“å‰è½®
        function endRound(reason, penaltyAmount = 0) {
            gameData.gameActive = false;
            gameData.roundEnded = true;
            
            // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡ - åªæ›´æ–°å½“å‰ç”¨æˆ·çš„æ•°æ®
            if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                gameData.users[gameData.currentUser].stats.roundsPlayed++;
                if (reason === 'stop') {
                    gameData.users[gameData.currentUser].stats.earlyExits++;
                } else if (reason === 'bomb') {
                    gameData.users[gameData.currentUser].stats.bombTriggers++;
                }
            }
            
            // è®°å½•æœ¬è½®æ•°æ®
            const roundData = {
                flippedCards: gameData.flippedCount,
                roundBonus: gameData.currentRoundBonus,
                endReason: reason,
                penaltyAmount: penaltyAmount,
                duration: Date.now() - gameData.currentPlayerSession.startTime
            };
            
            if (reason === 'bomb') {
                // æ‰£é™¤æƒ©ç½šé‡‘é¢è€Œä¸æ˜¯æ¸…é›¶
                gameData.totalBonus -= penaltyAmount;
                // ç¡®ä¿ä½™é¢ä¸ä¸ºè´Ÿæ•°
                if (gameData.totalBonus < 0) {
                    gameData.totalBonus = 0;
                }
                gameData.currentRoundBonus = 0;
                
                gameMessageEl.textContent = `ğŸ’£ ç‚¸å¼¹ï¼æ‰£é™¤æƒ©ç½šé‡‘é¢Â¥${penaltyAmount.toLocaleString()}ï¼Œå½“å‰ä½™é¢ï¼šÂ¥${gameData.totalBonus.toLocaleString()}`;
                gameMessageEl.style.color = '#f44336';
                
                // é‡‘é¢ä¸‹é™åŠ¨ç”»
                animateNumberRoll(currentBonusEl, 'Â¥0', false);
                animateNumberRoll(totalBonusEl, `Â¥${gameData.totalBonus.toLocaleString()}`, false);
                
                roundData.totalBonusAfter = gameData.totalBonus;
            } else if (reason === 'win') {
                gameData.totalBonus += gameData.currentRoundBonus;
                gameMessageEl.textContent = `ğŸ‰ å®Œç¾ï¼è·å¾—æœ¬è½®æ‰€æœ‰å¥–åŠ±ï¼å½“å‰ä½™é¢ï¼šÂ¥${gameData.totalBonus.toLocaleString()}`;
                gameMessageEl.style.color = '#4caf50';
                
                // é‡‘é¢ä¸Šå‡åŠ¨ç”»
                animateNumberRoll(totalBonusEl, `Â¥${gameData.totalBonus.toLocaleString()}`, true);
                
                roundData.totalBonusAfter = gameData.totalBonus;
            } else if (reason === 'stop') {
                gameData.totalBonus += gameData.currentRoundBonus;
                gameMessageEl.textContent = `ğŸ›‘ æœ¬è½®ç»“æŸï¼è·å¾—å¥–é‡‘ï¼šÂ¥${gameData.currentRoundBonus.toLocaleString()}ï¼Œå½“å‰ä½™é¢ï¼šÂ¥${gameData.totalBonus.toLocaleString()}`;
                gameMessageEl.style.color = '#ff9800';
                
                // é‡‘é¢ä¸Šå‡åŠ¨ç”»
                animateNumberRoll(totalBonusEl, `Â¥${gameData.totalBonus.toLocaleString()}`, true);
                
                roundData.totalBonusAfter = gameData.totalBonus;
            }
            
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç¤¼å“é—¨æ§›
            if (gameData.totalBonus >= 50000) {
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼æ‚¨çš„æ€»å¥–é‡‘å·²è¾¾åˆ°Â¥50,000ï¼Œå¯ä»¥è·å¾—ä¸€ä»½ç²¾ç¾ç¤¼å“ï¼');
                }, 1000);
            }
            
            roundData.endTime = Date.now();
            gameData.currentPlayerSession.rounds.push(roundData);
            gameData.currentPlayerSession.totalRewards = gameData.totalBonus;
            
            // æ›´æ–°ç”¨æˆ·æ€»å¥–åŠ±
            if (gameData.currentUser && gameData.users[gameData.currentUser]) {
                gameData.users[gameData.currentUser].stats.totalRewards = gameData.totalBonus;
            }
            
            // ä¿å­˜æ•°æ®
            saveUserData();
            
            // å°†å½“å‰æ¸¸æˆä¼šè¯æ·»åŠ åˆ°ç”¨æˆ·çš„ç‹¬ç«‹ä¼šè¯è®°å½•å’Œå…¨å±€è®°å½•
            if (gameData.currentPlayerSession && gameData.currentUser && gameData.users[gameData.currentUser]) {
                const sessionCopy = {...gameData.currentPlayerSession};
                
                // æ·»åŠ åˆ°ç”¨æˆ·çš„ç‹¬ç«‹sessionsæ•°ç»„
                if (!gameData.users[gameData.currentUser].sessions) {
                    gameData.users[gameData.currentUser].sessions = [];
                }
                gameData.users[gameData.currentUser].sessions.push(sessionCopy);
                
                // ä¹Ÿæ·»åŠ åˆ°å…¨å±€playerSessionsï¼ˆä¸ºäº†å‘åå…¼å®¹ï¼‰
                gameData.playerSessions.push(sessionCopy);
            }
            
            // å»¶è¿Ÿåè¿”å›å¼€å§‹æ¸¸æˆç•Œé¢
            setTimeout(() => {
                showGameReadyState();
            }, 2000);
        }
        
        // å¼€å§‹ä¸‹ä¸€è½®
        function nextRound() {
            showPaymentDialog();
        }
        
        // æ·»åŠ é”®ç›˜äº‹ä»¶æ”¯æŒï¼ˆå¯é€‰ï¼‰
        document.addEventListener('keydown', (event) => {
            // ESCé”®å…³é—­ç¡®è®¤å¯¹è¯æ¡†
            if (event.key === 'Escape') {
                hideConfirmDialog();
            }
        });
        
        // æ›´æ–°ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®
        function updateAdminStats() {
            // ä»æ‰€æœ‰ç”¨æˆ·æ•°æ®ä¸­ç»Ÿè®¡å…¨å±€æ•°æ®
            let totalFlips = 0;
            let totalGames = 0;
            let totalRounds = 0;
            let totalEarlyExits = 0;
            let totalBombTriggers = 0;
            let totalRewards = 0;
            let totalUsers = 0;
            
            // éå†æ‰€æœ‰ç”¨æˆ·ç»Ÿè®¡æ•°æ®
            Object.keys(gameData.users).forEach(username => {
                if (username === 'admin') return; // è·³è¿‡ç®¡ç†å‘˜è´¦å·
                
                const userData = gameData.users[username];
                if (userData.stats) {
                    totalFlips += userData.stats.totalFlips || 0;
                    totalGames += userData.stats.gamesPlayed || 0;
                    totalRounds += userData.stats.roundsPlayed || 0;
                    totalEarlyExits += userData.stats.earlyExits || 0;
                    totalBombTriggers += userData.stats.bombTriggers || 0;
                    totalRewards += (userData.stats.totalRewards || 0) - (userData.initialFund || 2000);
                    totalUsers++;
                }
            });
            
            // æ›´æ–°æ˜¾ç¤º
            totalFlipsEl.textContent = totalFlips.toLocaleString();
            totalGamesEl.textContent = totalGames.toLocaleString();
            
            // æå‰é€€å‡ºç‡ (åŸºäºè½®æ¬¡)
            const earlyExitRate = totalRounds > 0 ? 
                (totalEarlyExits / totalRounds) * 100 : 0;
            earlyExitRateEl.textContent = `${earlyExitRate.toFixed(1)}%`;
            
            // ç‚¸å¼¹è§¦å‘ç‡
            const bombRate = totalRounds > 0 ? 
                (totalBombTriggers / totalRounds) * 100 : 0;
            bombRateEl.textContent = `${bombRate.toFixed(1)}%`;
            
            // æ”¶ç›Šåç¦»åº¦ - è®¡ç®—å®é™…æ”¶ç›Šä¸æœŸæœ›æ”¶ç›Šçš„åç¦»
            const expectedTotalReward = totalGames * 200 * 0.3; // æœŸæœ›æ¯åœºæ¸¸æˆå‡€æ”¶ç›Š30%
            const profitDeviation = expectedTotalReward > 0 ? 
                Math.abs(totalRewards - expectedTotalReward) / expectedTotalReward : 0;
            profitDeviationEl.textContent = profitDeviation.toFixed(2);
            
            // é£é™©ä¼°è®¡è¯¯å·® - åŸºäºæ‰€æœ‰ç”¨æˆ·çš„å¹³å‡ç¿»ç‰Œè¡Œä¸º
            let totalRiskError = 0;
            if (totalUsers > 0 && totalRounds > 0) {
                const avgFlipsPerRound = totalFlips / totalRounds;
                const optimalFlipsPerRound = 8; // ç†è®ºæœ€ä¼˜ç¿»ç‰Œæ•°
                totalRiskError = Math.abs(avgFlipsPerRound - optimalFlipsPerRound) / optimalFlipsPerRound;
            }
            riskErrorEl.textContent = totalRiskError.toFixed(2);
            
            // æ›´æ–°ç”¨æˆ·è¯¦ç»†æ•°æ®
            updateUserDataTable();
        }
        
        function updateUserDataTable() {
            const userDataList = document.getElementById('user-data-list');
            userDataList.innerHTML = '';
            
            Object.keys(gameData.users).forEach(username => {
                if (username === 'admin') return; // è·³è¿‡ç®¡ç†å‘˜è´¦å·
                
                const userData = gameData.users[username];
                const userRow = document.createElement('div');
                userRow.className = 'user-row';
                
                // ç¡®ä¿ç»Ÿè®¡æ•°æ®å­˜åœ¨
                if (!userData.stats) {
                    userData.stats = {
                        totalFlips: 0,
                        gamesPlayed: 0,
                        roundsPlayed: 0,
                        earlyExits: 0,
                        bombTriggers: 0,
                        totalRewards: userData.initialFund || 2000
                    };
                }
                
                // è®¡ç®—ç”¨æˆ·ç»Ÿè®¡æ•°æ®
                const earlyExitRate = userData.stats.roundsPlayed > 0 ? 
                    (userData.stats.earlyExits / userData.stats.roundsPlayed * 100).toFixed(1) : '0.0';
                const bombRate = userData.stats.roundsPlayed > 0 ? 
                    (userData.stats.bombTriggers / userData.stats.roundsPlayed * 100).toFixed(1) : '0.0';
                
                // æ”¶ç›Šåç¦»åº¦ï¼šå®é™…æ”¶ç›Šä¸æœŸæœ›æ”¶ç›Šçš„åå·®
                const expectedReward = userData.stats.gamesPlayed > 0 ? 
                    userData.stats.gamesPlayed * 200 * 0.6 : 2000; // æœŸæœ›æ¯åœºæ¸¸æˆå‡€æ”¶ç›Š60%
                const actualReward = userData.stats.totalRewards - (userData.initialFund || 2000);
                const profitDeviation = expectedReward > 0 ? 
                    Math.abs(actualReward - expectedReward) / Math.max(expectedReward, 100) : 0;
                
                // é£é™©ä¼°è®¡è¯¯å·®ï¼šåŸºäºç¿»ç‰Œè¡Œä¸ºçš„é£é™©ä¼°è®¡å‡†ç¡®æ€§
                const avgFlipsPerRound = userData.stats.roundsPlayed > 0 ? 
                    userData.stats.totalFlips / userData.stats.roundsPlayed : 0;
                const optimalFlipsPerRound = 8; // ç†è®ºæœ€ä¼˜ç¿»ç‰Œæ•°
                const riskError = Math.abs(avgFlipsPerRound - optimalFlipsPerRound) / optimalFlipsPerRound;
                
                userRow.innerHTML = `
                    <div>${username}</div>
                    <div>${userData.stats.totalFlips}</div>
                    <div>${earlyExitRate}%</div>
                    <div>${profitDeviation.toFixed(2)}</div>
                    <div>${riskError.toFixed(2)}</div>
                    <div>${bombRate}%</div>
                    <div>
                        <button class="btn-small" onclick="viewUserDetail('${username}')">è¯¦æƒ…</button>
                        <button class="btn-small btn-danger" onclick="deleteUser('${username}')">åˆ é™¤</button>
                    </div>
                `;
                
                userDataList.appendChild(userRow);
            });
        }
        
        function deleteUser(username) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${username}" çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿ`)) {
                // åˆ é™¤ç”¨æˆ·çš„æ‰€æœ‰æ•°æ®
                delete gameData.users[username];
                
                // ä»å…¨å±€playerSessionsä¸­åˆ é™¤è¯¥ç”¨æˆ·çš„ç›¸å…³ä¼šè¯
                gameData.playerSessions = gameData.playerSessions.filter(session => 
                    session.username !== username);
                
                saveUserData();
                updateUserDataTable();
            }
        }
        
        // æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
        function viewUserDetail(username) {
            const userData = gameData.users[username];
            if (!userData) {
                alert('ç”¨æˆ·æ•°æ®ä¸å­˜åœ¨');
                return;
            }
            
            // è·å–ç”¨æˆ·çš„ç‹¬ç«‹æ¸¸æˆä¼šè¯ - ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·è‡ªèº«çš„sessionsæ•°ç»„
            let userSessions = userData.sessions || [];
            
            // å¦‚æœç”¨æˆ·sessionsä¸ºç©ºï¼Œå°è¯•ä»å…¨å±€playerSessionsä¸­æŸ¥æ‰¾è¯¥ç”¨æˆ·çš„ä¼šè¯
            if (userSessions.length === 0) {
                userSessions = gameData.playerSessions.filter(session => 
                    session.username === username);
            }
            
            let detailInfo = `=== ${username} ç”¨æˆ·è¯¦æƒ… ===\n\n`;
            detailInfo += `æ³¨å†Œæ—¶é—´: ${new Date(userData.created).toLocaleString()}\n`;
            detailInfo += `å½“å‰ä½™é¢: Â¥${userData.stats.totalRewards.toLocaleString()}\n`;
            detailInfo += `æ€»æ¸¸æˆåœºæ¬¡: ${userData.stats.gamesPlayed}\n`;
            detailInfo += `æ€»æ¸¸æˆè½®æ¬¡: ${userData.stats.roundsPlayed}\n`;
            detailInfo += `æ€»ç¿»ç‰Œæ•°: ${userData.stats.totalFlips}\n`;
            detailInfo += `æå‰é€€å‡ºæ¬¡æ•°: ${userData.stats.earlyExits}\n`;
            detailInfo += `ç‚¸å¼¹è§¦å‘æ¬¡æ•°: ${userData.stats.bombTriggers}\n\n`;
            
            // æ˜¾ç¤ºæ¯ä¸ªæ¸¸æˆä¼šè¯çš„è¯¦ç»†ä¿¡æ¯
            if (userSessions.length > 0) {
                detailInfo += `=== æ¸¸æˆè¯¦æƒ… ===\n`;
                userSessions.forEach((session, sessionIndex) => {
                    detailInfo += `\nç¬¬${sessionIndex + 1}åœºæ¸¸æˆ (${new Date(session.startTime).toLocaleString()}):\n`;
                    detailInfo += `æ€»ç¿»ç‰Œæ•°: ${session.totalFlips || 0}\n`;
                    detailInfo += `ç‚¸å¼¹è§¦å‘æ¬¡æ•°: ${session.totalBombHits || 0}\n`;
                    detailInfo += `æœ€ç»ˆå¥–åŠ±: Â¥${session.totalRewards || 0}\n`;
                    
                    if (session.rounds && session.rounds.length > 0) {
                        detailInfo += `è½®æ¬¡è¯¦æƒ…:\n`;
                        session.rounds.forEach((round, roundIndex) => {
                            detailInfo += `  è½®æ¬¡${roundIndex + 1}: ç¿»ç‰Œ${round.flippedCards}å¼ `;
                            if (round.endReason === 'bomb') {
                                detailInfo += `, è§¦å‘ç‚¸å¼¹ï¼Œæƒ©ç½šÂ¥${round.penaltyAmount || 0}`;
                            } else if (round.endReason === 'win') {
                                detailInfo += `, å®Œç¾é€šå…³ï¼Œå¥–åŠ±Â¥${round.roundBonus || 0}`;
                            } else if (round.endReason === 'stop') {
                                detailInfo += `, æå‰ç»“æŸï¼Œè·å¾—Â¥${round.roundBonus || 0}`;
                            }
                            detailInfo += `\n`;
                        });
                    }
                });
            } else {
                detailInfo += 'æš‚æ— æ¸¸æˆè®°å½•\n';
            }
            
            // ä½¿ç”¨alertæ˜¾ç¤ºè¯¦æƒ…ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨æ¨¡æ€æ¡†ï¼‰
            alert(detailInfo);
        }
        
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                gameData.users = {};
                gameData.playerSessions = [];
                gameData.stats = {
                    totalFlips: 0,
                    gamesPlayed: 0,
                    roundsPlayed: 0,
                    earlyExits: 0,
                    bombTriggers: 0,
                    totalPossibleReward: 0,
                    totalActualReward: 0,
                    riskEstimations: [],
                    averageCardsFlippedPerRound: 0
                };
                saveUserData();
                updateAdminStats();
                alert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
            }
        }
        
        // äº‹ä»¶ç›‘å¬
        document.getElementById('login-btn').addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const errorEl = document.getElementById('error-message');
            
            errorEl.textContent = '';
            
            if (!username || !password) {
                errorEl.textContent = 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ';
                return;
            }
            
            if (gameData.isRegistering) {
                // æ³¨å†Œæ¨¡å¼
                if (password !== confirmPassword) {
                    errorEl.textContent = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
                    return;
                }
                
                const result = registerUser(username, password);
                if (result.success) {
                    errorEl.style.color = '#4caf50';
                    errorEl.textContent = result.message;
                    
                    // åˆ‡æ¢å›ç™»å½•æ¨¡å¼
                    setTimeout(() => {
                        toggleRegisterMode(false);
                        document.getElementById('username').value = username;
                        document.getElementById('password').value = '';
                        errorEl.textContent = '';
                        errorEl.style.color = '#ff4444';
                    }, 1500);
                } else {
                    errorEl.textContent = result.message;
                }
            } else {
                // ç™»å½•æ¨¡å¼
                const result = loginUser(username, password);
                if (result.success) {
                    if (result.isAdmin) {
                        loginPage.classList.remove('active');
                        adminPage.classList.add('active');
                        updateAdminStats();
                    } else {
                        // æ™®é€šç”¨æˆ·å…ˆæ˜¾ç¤ºæ¸¸æˆè§„åˆ™é¡µé¢
                        loginPage.classList.remove('active');
                        rulesPage.classList.add('active');
                    }
                } else {
                    errorEl.textContent = result.message;
                }
            }
        });
        
        document.getElementById('register-btn').addEventListener('click', () => {
            toggleRegisterMode(!gameData.isRegistering);
        });
        
        function toggleRegisterMode(isRegistering) {
            gameData.isRegistering = isRegistering;
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            const confirmPasswordGroup = document.getElementById('confirm-password-group');
            const errorEl = document.getElementById('error-message');
            
            if (isRegistering) {
                loginBtn.textContent = 'ç¡®è®¤æ³¨å†Œ';
                registerBtn.textContent = 'è¿”å›ç™»å½•';
                confirmPasswordGroup.style.display = 'block';
            } else {
                loginBtn.textContent = 'ç™»å½•æ¸¸æˆ';
                registerBtn.textContent = 'æ³¨å†Œè´¦å·';
                confirmPasswordGroup.style.display = 'none';
                document.getElementById('confirm-password').value = '';
            }
            
            errorEl.textContent = '';
            errorEl.style.color = '#ff4444';
        }
        
        // æ¸¸æˆè§„åˆ™é¡µé¢äº‹ä»¶ç›‘å¬
        document.getElementById('exit-to-login-btn').addEventListener('click', () => {
            rulesPage.classList.remove('active');
            loginPage.classList.add('active');
            
            // æ¸…é™¤è¾“å…¥æ¡†
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('error-message').textContent = '';
        });
        
        document.getElementById('enter-game-btn').addEventListener('click', () => {
            rulesPage.classList.remove('active');
            gamePage.classList.add('active');
            
            // åˆå§‹åŒ–æ¸¸æˆé¡µé¢
            initGame();
        });
        
        document.getElementById('start-game-btn').addEventListener('click', () => {
            // æ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³
            if (gameData.totalBonus < gameData.roundCost) {
                alert(`ä½™é¢ä¸è¶³ï¼å½“å‰ä½™é¢ï¼šÂ¥${gameData.totalBonus.toLocaleString()}ï¼Œæ¸¸æˆè´¹ç”¨ï¼šÂ¥${gameData.roundCost.toLocaleString()}`);
                return;
            }
            
            // æ˜¾ç¤ºæ‰£è´¹ç¡®è®¤å¯¹è¯æ¡†
            if (confirm(`å¼€å§‹æ¸¸æˆå°†æ‰£é™¤Â¥${gameData.roundCost.toLocaleString()}ï¼Œå½“å‰ä½™é¢ï¼šÂ¥${gameData.totalBonus.toLocaleString()}ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ`)) {
                startNewRound();
            }
        });
        
        document.getElementById('stop-round-btn').addEventListener('click', () => {
            if (gameData.gameActive && !gameData.roundEnded) {
                showConfirmDialog();
            }
        });
        
        document.getElementById('dialog-confirm').addEventListener('click', () => {
            hideConfirmDialog();
            endRound('stop');
        });
        
        document.getElementById('dialog-cancel').addEventListener('click', () => {
            hideConfirmDialog();
        });
        
        // ä»˜è´¹å¯¹è¯æ¡†äº‹ä»¶ç›‘å¬
        document.getElementById('payment-confirm').addEventListener('click', () => {
            hidePaymentDialog();
            startNewRound();
        });
        
        document.getElementById('payment-cancel').addEventListener('click', () => {
            hidePaymentDialog();
        });
        
        document.getElementById('exit-game-btn').addEventListener('click', exitToLogin);
        
        document.getElementById('clear-all-data-btn').addEventListener('click', clearAllData);
        
        document.getElementById('logout-btn').addEventListener('click', () => {
            // æ¸…é™¤è®¤è¯token
            gameAPI.clearToken();
            
            adminPage.classList.remove('active');
            loginPage.classList.add('active');
            
            // æ¸…é™¤è¾“å…¥æ¡†
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('error-message').textContent = '';
        });
        
        // åç«¯è¿æ¥çš„ç™»å½•å‡½æ•°
        async function loginUser(username, password) {
            try {
                if (username === 'admin' && password === 'admin001') {
                    return { success: true, isAdmin: true };
                }
                
                const response = await gameAPI.login(username, password);
                if (response.success) {
                    gameAPI.setToken(response.token);
                    gameData.currentUser = username;
                    return { success: true, isAdmin: false };
                } else {
                    return { success: false, message: response.message || 'ç™»å½•å¤±è´¥' };
                }
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                return { success: false, message: error.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•' };
            }
        }
        
        // åç«¯è¿æ¥çš„æ³¨å†Œå‡½æ•°
        async function registerUser(username, password) {
            try {
                const response = await gameAPI.register(username, password);
                if (response.success) {
                    return { success: true, message: 'æ³¨å†ŒæˆåŠŸ', isNewUser: true };
                } else {
                    return { success: false, message: response.message || 'æ³¨å†Œå¤±è´¥' };
                }
            } catch (error) {
                console.error('æ³¨å†Œé”™è¯¯:', error);
                return { success: false, message: error.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•' };
            }
        }
        
        // æ›´æ–°ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®ä»¥ä½¿ç”¨åç«¯API
        async function updateAdminStats() {
            try {
                const stats = await gameAPI.getAdminStats();
                const users = await gameAPI.getAllUsers();
                
                // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
                totalFlipsEl.textContent = stats.data.totalFlips || '0';
                totalGamesEl.textContent = stats.data.totalGames || '0';
                earlyExitRateEl.textContent = `${(stats.data.earlyExitRate || 0).toFixed(1)}%`;
                bombRateEl.textContent = `${(stats.data.bombRate || 0).toFixed(1)}%`;
                profitDeviationEl.textContent = (stats.data.profitDeviation || 0).toFixed(2);
                riskErrorEl.textContent = (stats.data.riskError || 0).toFixed(2);
                
                // æ›´æ–°ç”¨æˆ·è¯¦ç»†æ•°æ®è¡¨æ ¼
                await updateUserDataTable(users.data);
            } catch (error) {
                console.error('è·å–ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                // å¦‚æœåç«¯å¤±è´¥ï¼Œæ˜¾ç¤ºé»˜è®¤æ•°æ®
                totalFlipsEl.textContent = '0';
                totalGamesEl.textContent = '0';
                earlyExitRateEl.textContent = '0.0%';
                bombRateEl.textContent = '0.0%';
                profitDeviationEl.textContent = '0.00';
                riskErrorEl.textContent = '0.00';
            }
        }
        
        // åˆå§‹åŒ–
        window.onload = () => {
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„è®¤è¯token
            const savedToken = localStorage.getItem('authToken');
            if (savedToken) {
                gameAPI.setToken(savedToken);
            }
            
            console.log('æ¸¸æˆå·²åŠ è½½ï¼Œç‰ˆæœ¬: 2025-08-12 Backend Connected');
        };
    </script>
</body>
</html>